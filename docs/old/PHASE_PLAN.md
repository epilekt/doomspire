# 1) Первые предметы и цепочки крафтов

## Регистрируем предметы 
**Файл:** `grimfate/src/main/java/com/doomspire/grimfate/registry/ModItems.java`

**Оружие/щит:**
- `copper_sword`
- `scholar_staff`
- `weakling_bow`
- `copperforced_shield`
- сет брони `copper_chestplate` и др. локализуем, как Медное
- сет брони `rawhide_jacket` и др. локализуем, как Сыромятное
- сет брони `linen_cape` и др. локализуем, как Холщёвое

**Материалы (для крафтов):**
- `fiber`, `canvas_fabric`, `pork_fat`, `rawhide` + ванильные Медный слиток, Нить, Кожа, Палка, Доски (теги досок)

**Компоненты данных (item data components):** подключаем уже используемые `stat_bonus`, `material_tag`, `class_tag`.
То есть зависимость от материала (латная, кожаная, тканевая броня) и для игроков ближнего/дальнего боя и магов.

## Теги для требований к оружию 
**Директория:** `data/grimfate/tags/items/`
- `melee_weapons.json` или раздельно `swords.json, axes.json, hammers.json`
- `staves.json`
- `ranged_weapons.json` или раздельно `bows.json, crossbows.json`
- `daggers.json` вероятное отличие - возможность атаки с двух рук, в каждой по кинжалу
- `two_handed.json`

*Делаем «мост» к Better Combat: если мод найден, читаем/мэппим их теги в наши.*

## Рецепты (пока ванильные) 
**Директория:** `data/grimfate/recipes/*.json`
- `copper_sword.json`, `scholar_staff.json`, `weakling_bow`, `copperforced_shield`, `все элементы сетов брони`

*Материалы включаем в первую цепочку рецептов, (`rusty_sword`, `weathered_staff`, `simple_bow`)*

## ПКМ-автоатака «Bolt» для посохов
В `scholar_staff` задаём поведение ПКМ: если удерживается ПКМ — «стреляем» базовым Bolt-снарядом с микро-манакостом и малым уроном.

**Реализация:**
- `grimcore/spell/impl/AutoBoltSpell.java` (очень лёгкий: маленький `mana_cost`, `cooldown`~8–12 тиков, урезанный урон).
- Хук в `Item#use` для стаффов → отправка `C2SCastSpellSlotPayload` с зарезервированным id «auto_bolt_staff»; сервер проверяет, что в main/offhand — предмет с тегом `staves`.

# 2) Броня, бижутерия, Curios

## Сеты ранней игры
`grimfate/registry/ModArmor.java` + модели/ресурсы

Наборы без привязки к классу, но с явным «наклоном»:
- **«Scholar»** (маг/священник): +SPIRIT/+INT, небольшой `mana_regen и др.`
- **«Scout»** (лучник/ассасин): +DEX/+EVASION, `move_speed и др.`
- **«Militia»** (рыцарь/берсерк): +STR/+VIT, немного `damage_reduction и др.`

## Бижутерия (Curios)
**Файл:** `grimfate/registry/ModCurios.java`

**Кольца:** `copper_ring`, `bronze_ring`  
**Ожерелья:** `copper_necklace`, `bronze_necklace`

**Интеграция:**
- Curios присутствует — регистрируем типы слотов `ring` (2), `necklace` (1), и читаем статы из наших data-компонентов.

*Баланс/бонусы бижутерии — через `stat_bonus` component (сугубо data-driven).*

# 3) Дерево навыков (интерфейс + данные)

## Типы узлов
- **SPELL** — разблокирует/вкладывает в хотбар доступ к умению.
- **STAT** — +к базовым характеристикам (STR/DEX/INT/SPIRIT/VIT/END/EVASION и т.п.).
- **ATTRIBUTE** — +к мод-атрибутам (`elemental_damage%`, `mana_regen`, `crit_chance`, `damage_reduction_all` и т.п.).

## Экран
**Файл:** `grimfate/client/gui/SkillTreeScreen.java`

- Канва, узлы, линии связей, тултипы, фильтры (класс/ветка).
- Обработка покупки узлов, проверка `requires`, списание поинтов.
- Сразу используем resource-reload для hot-swap дерева.

## Сохранение/синк
`grimcore/attach/PlayerProgressAttachment`

**Поля:** `chosenClass`, `skillPoints`, `unlockedNodes: Set<ResourceLocation>`.  
**Сетевые payload'ы:** `C2SChooseClass`, `C2SUnlockNode`, `S2CSyncProgress`.

# 4) Привязка к классу и 3 стартовых узла-пути

Узлы: **Путь Битвы**, **Путь Чар**, **Путь Охоты** — доступны всем, дают базовые статы и открывают по 1–2 ветки

От каждого «пути» — узел-заклинание, затем 1–2 пассивки, которые уже «наводят» на будущие 6 архетипов (Берсерк, Рыцарь, Священник, Маг-ДД, Охотник, Ассасин).

При первом входе: модальный выбор класса (можно отложить до активации первого «пути», но лучше фиксировать заранее). Храним в `PlayerProgressAttachment`.

# 5) Заклинания по архетипам (первый круг)

Все параметры — в `data/grimfate/balance/spells.json`. Ниже — Баланс №0 (стартовые числа, чтобы было что тестировать). Все спеллы проверяют тэг-требования к оружию.

## 5.1 Рыцарь — «Могучий удар»
- **Тип:** ближний конус/дуга перед игроком (анимация взмаха; можно позже подключить GeckoLib)
- **Требует:** `#grimfate:melee_weapons`
- **Эффект:** 58 физ. урона × (1 + 0.6 * STR_scaling) по цели(ям)
- **Угроза:** +10 * (1 + 0.5 * STR_scaling) в таблицу угрозы ближайшего моба(ов)
- **КД/Ресурсы:** 20 тиков, мана 0
- **Вариант реализации:** хитбокс арки (Raycast + угол к вектору взгляда), или короткий «клин» AABB

*Новая механика генерации угрозы*

## 5.2 Берсерк — «Насмешка»
- **Тип:** крик-таунт (AoE 8–12 блоков)
- **Требует:** `#grimfate:melee_weapons`
- **Эффект:** даёт 1 стак Уверенности на 10 сек; каждый стак: −3% входящего всего урона (множитель `damage_reduction_all`), максимум 5 стаков
- **Угроза:** +5 * (1 + 0.6 * VIT_scaling) всем мобам в радиусе
- **КД/Мана:** 10 с, мана 10
- **Замечание про резисты:** чтобы резать любой урон, не через elemental-resists, а единый `damage_reduction_all` в снапшоте (мультипликативно в DamageEngine поверх резистов)

*Новая механика генерации угрозы*

*Новая механика стаков/накполения эффекта*

## 5.3 Священник — «Крещение»
- **Тип:** бафф-щит для себя и союзников в радиусе R
- **Требует:** `#grimfate:staves`
- **Эффект:** выдаёт temporary HP (overshield) = 20 × (1 + 0.4 * SPIRIT_scaling) на 15 c, радиус R = 6 × (1 + 0.3 * INT_scaling)
- **КД/Мана:** 18 c, мана 25
- **Тех:** overshield как отдельное поле в PlayerStatsAttachment (не ванильный Absorption), снимается первым

*Новая механика баффов*

## 5.4 Маг — «Огненный шар»
- **Тип:** снаряд с дугой, взрыв по месту контакта (малый радиус)
- **Требует:** `#grimfate:staves`
- **Урон:** 70 огнём × (1 + 0.7 * INT_scaling), шанс Поджога 5%
- **DoT Поджога:** 5/сек × (1 + 0.4 * SPIRIT_scaling) на 4 сек; стакается до 3 раз
- **КД/Мана:** 3 c, мана 16
- **Тех:** отдельный FireballEntity, серверный детонатор; статус BURNING

*Новая механика АоЕ-урон*

## 5.5 Охотник — «Заряженный выстрел»
- **Тип:** «тяжёлая» стрела без падения траектории до N блоков
- **Требует:** `#grimfate:ranged_weapons`
- **Урон:** 40 физ. × (1 + 0.7 * DEX_scaling); пробивает 1 цель с ослаблением урона на 30%
- **КД/Мана:** 2.5 c, мана 8

*Новая механика неизменяемой траектории/баллистики*

## 5.6 Ассасин — «Удар в спину»
- **Тип:** самобафф + гарантированный бонус к первому удару
- **Требует:** `#grimfate:daggers`
- **Эффект:** Невидимость на 3 × (1 + 0.5 * EVASION_scaling) сек, первый удар из невидимости: +30 физ. × (1 + 0.5 * STR_scaling) и гарант. крит
- **КД/Мана:** 12 c, мана 12
- **Тех:** временный флаг «stealth», снижаем радиус агро, снимается при атаке/получении урона

*Новая механика баффов*

# 6) Таблица угроз и ИИ-агро (новая механика)

`grimcore/attach/MobThreatAttachment`

`Map<UUID player, float threat>`

**Методы:** `addThreat(player, amount)`, `decay(dt)`, `topThreatTarget()`

**Подписка ИИ** (каждые 10 тиков): если есть игрок с наибольшей угрозой в радиусе — ставим TargetGoal на него; плавное затухание угрозы (−X%/с).

**Интеграция:**
- Спеллы добавляют угрозу через единый ThreatService
- Урон тоже генерирует угрозу (1 к 1 базово), модифицируем коэффициентами архетипов/узлов
- Оптимизация: хранить/тикать только у существ «в бою» (видят игрока или получили урон за последние N сек)

# 7) Balance №0 (данные)

`data/grimfate/balance/`

- `attributes.json` — стартовые базовые статы, софт-кап/скейлинги
- `spells.json` — параметры шести спеллов (как выше)
- `levels.json` — кривая XP 1–10 для ранней игры, выдача: +1 skill-point/ур., базовые очки характеристик
- `loot_tables/*` — ранние кольца, реагенты, материалы; стартовые структуры (сундуки лагерей/подземок) подключим позже

*Все формулы урона/щит/резистов — консолидированы в DamageEngine/StatCalculator, никакой дубли в спеллах.*

# 8) UI дерева навыков и иконки

- `grimfate/client/gui/SkillTreeScreen.java` — отрисовка, скролл/зум, «покупка» по клику
- `textures/gui/skills/*.png` — иконки «Путь воина/волшебника/плута», архетипы и спеллы

**UX:** подсветка доступных узлов, предпросмотр эффекта (tooltip с рассчитанными числами по текущим статам), индикация классовых ограничений

# 9) Аффиксы, тиры редкости

- `Обычный, Необычный, Редкий, Эпический, Легендарный`, будут ролиться на снаряжении, бижутерии, оружии, возможно на мобах и др.
- Система аффиксов, по аналогии с Mine and Slash будет наделять снаряжение/бижутерию/оружие/мобов определенным набором бонусных характеристик
